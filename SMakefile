if test ! -x configure; then
  echo rm -f lib/plugin_common.c lib/plugin_common.h
  rm -f lib/plugin_common.c lib/plugin_common.h
  echo ln -s ../plugins/plugin_common.c lib
  ln -s ../plugins/plugin_common.c lib
  echo ln -s ../plugins/plugin_common.h lib
  ln -s ../plugins/plugin_common.h lib
  echo aclocal -I cmulocal -I config
  aclocal -I cmulocal -I config
  echo autoheader
  autoheader
  echo autoconf
  autoconf
  echo automake --add-missing --include-deps
  automake --add-missing --include-deps
  echo cd saslauthd
  cd saslauthd
  echo aclocal -I ../cmulocal -I config
  aclocal -I ../cmulocal -I config -I ../config
  echo autoheader
  autoheader
  echo autoconf 
  autoconf
  echo automake --add-missing --include-deps
  automake --add-missing --include-deps
fi

LIBS=""
case `uname` in
  Linux) CFLAGS="${CFLAGS} -O2 -g"
	 LNEXTRA=" --with-javabase=/usr/local/lib/java/"
	 ;;

  SunOS) CC="gcc"
	 CFLAGS="${CFLAGS} -O2 -g"
	 LNEXTRA=" --with-javabase=/usr/java/"
#	 CC="cc"
#	 if test "${WASH_CYRUS_DEBUG}" = "t"; then
#	   CFLAGS="${CFLAGS} -xs -g"
#         else
#	   CFLAGS="${CFLAGS} -xO3 -xdepend"
#         fi
	 ;;
esac

MAKE=gmake
LNCOMMAND="${SRCDIR}/configure --with-staticsasl --prefix=/usr/local --enable-cmulocal --with-sfio=/usr/local --enable-java ${LNEXTRA} --with-saslauthd=/var/run/saslauthd --enable-login --disable-srp --disable-otp --disable-checkapop"
CPPFLAGS=-I/usr/local/include/gssapi
INSTCOMMAND="rm -rf ${DESTDIR}/*; ${MAKE} DESTDIR=${DESTDIR} install; echo 'usr/local /' > ${DESTDIR}/depot.conf; echo 'usr/local/sbin/smtptest bin/smtptest' >> ${DESTDIR}/depot.conf; echo '~delete sbin/smtptest' >> ${DESTDIR}/depot.conf"

export CC CFLAGS CPPFLAGS LIBS
